#+TITLE: Ming's Emacs Configuration
#+AUTHOR: Ming
#+DATE: 2025
#+DESCRIPTION: A Emacs configuration
#+OPTIONS: toc:2 num:nil
#+STARTUP: showeverything

This is a modern, vanilla Emacs configuration that prioritizes simplicity, performance, and maintainability. It follows Emacs best practices while providing a modular structure.

** Philosophy

*** Built-in First
- Prefer Emacs built-in packages over external alternatives
- Use ~use-package~ for external packages with ~:ensure t~
- Leverage modern Emacs features (tree-sitter, eglot, etc.)

*** Minimal Complexity
- Core settings live directly in ~init.el~
- Modular structure only where it provides clear benefits
- No unnecessary abstractions or complex loading systems
- Readable, self-documenting code

*** Performance Oriented
- Optimized startup with ~early-init.el~
- Lazy loading where appropriate
- Minimal package dependencies
- Efficient completion stack (vertico, corfu, marginalia)

*** Modern Development
- LSP integration via built-in ~eglot~
- Tree-sitter for syntax highlighting (Emacs 29+)
- Contemporary completion UI
- Git integration with Magit

** Email Setup (mu4e)

This configuration includes mu4e for email management with XDG compliance and full data desensitization.

*** Quick Start

1. Install: ~sudo apt install mu4e isync~ (or ~brew install mu isync~)
2. Configure: Copy and edit example files in ~private/~ directory
3. Sync: ~mbsync -a && mu index~
4. Launch: ~M-x mu4e~ or ~C-c m~

*** Complete Documentation

See [[file:docs/mu4e.org][docs/mu4e.org]] for detailed setup instructions, including:
- Step-by-step configuration guide
- Common email provider settings (Gmail, Outlook, ProtonMail)
- Multiple account setup
- Troubleshooting tips
- Security best practices

*** Security Note

All sensitive data (passwords, email addresses) is in the ~private/~ directory and git-ignored. Only template files with placeholders are committed.

** Supported Languages

The project uses the treesitter mode for languges, e.g. "js-ts-mode" for javascript.

Please install related treesitter library:

~M-x~  ~treesit-install-language-grammar~

** Required Dependencies

*** Language Servers

Install these for full language support:

#+BEGIN_SRC bash
# C/C++
sudo apt install clangd  # or brew install llvm

# Python  
pip install python-lsp-server[all] ruff black isort

# Rust
rustup component add rust-analyzer rustfmt clippy

# JavaScript/TypeScript
npm install -g typescript-language-server typescript prettier

# Go
go install golang.org/x/tools/gopls@latest
go install golang.org/x/tools/cmd/goimports@latest
#+END_SRC

** Applying Configuration Changes

*** Reloading Configuration Without Restart

To apply changes without restarting Emacs:

#+BEGIN_SRC elisp
M-x eval-expression RET (load-file user-init-file) RET
#+END_SRC

Or evaluate in scratch buffer:
#+BEGIN_SRC elisp
(load-file user-init-file)
#+END_SRC

*** Important Precautions

**** early-init.el Changes
- *Requires full restart*: ~early-init.el~ is loaded before the GUI initializes
- Changes to frame parameters, package system, or performance settings need restart
- Reloading ~init.el~ will NOT apply ~early-init.el~ changes

**** Non-Idempotent Operations
Some configurations may not work correctly on reload:

- *Hooks*: May be added multiple times if not idempotent
  #+BEGIN_SRC elisp
  ;; BAD - adds hook every reload
  (add-hook 'prog-mode-hook 'my-function)

  ;; GOOD - removes first to ensure single instance
  (remove-hook 'prog-mode-hook 'my-function)
  (add-hook 'prog-mode-hook 'my-function)
  #+END_SRC

- *Key bindings*: Safe to reload, will override previous bindings
- *Themes*: Handled correctly - old themes are disabled before loading new ones
- *Global modes*: Safe to reload, toggling with same value is harmless

**** Buffer-Specific Settings
After reloading configuration:

- *Existing buffers*: Keep old settings and local variables
- *Apply to buffer*: Use ~M-x revert-buffer~ or kill and reopen buffer
- *Major modes*: May need to run ~M-x <mode-name>~ to reapply mode
- *LSP connections*: May need ~M-x eglot-reconnect~ or buffer revert

**** Quick Reference
- Reload init: ~(load-file user-init-file)~
- Refresh buffer: ~M-x revert-buffer~
- Restart mode: ~M-x <mode-name>~ (e.g., ~M-x python-ts-mode~)
- Reconnect LSP: ~M-x eglot-reconnect~
- Full restart: Safest option for major changes

** Troubleshooting

*** Common Issues

- *LSP not starting*: Check if language server is installed and in PATH
- *Packages not installing*: Check network connection and package archives

*** Feature Name Conflicts

- *Feature name unique*: Make the feature named by ~provide~ is unique.
  Use ~M-x describe-variable RET features RET~ to check all features.
  
*** Debugging

- *Check ~*Messages*~ buffer* for error messages
- *Use ~emacs --debug-init~* for startup issues
- *Check LSP status* with ~M-x eglot-events-buffer~

*** Getting Help

- *Built-in help*: ~C-h~ prefix commands
- *Package documentation*: ~C-h P <package-name>~
- *Function help*: ~C-h f <function-name>~
- *Variable help*: ~C-h v <variable-name>~

** Contributing

*** Code Style

- Use ~lexical-binding: t~ in all files
- Include proper file headers with description
- Group related configurations together
- Comment complex or non-obvious configurations
- Use consistent indentation (2 spaces for Lisp)
- Prefer ~use-package~ for external packages with ~:ensure t~
- Use ~setq-default~ for global defaults, ~setq~ for local settings
- Keep line length under 80 characters where practical

